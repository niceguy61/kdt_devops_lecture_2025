services:
  web:
    build: .
    depends_on:
      api:
        condition: service_healthy  # ğŸ”¥ í—¬ìŠ¤ì²´í¬ ëŒ€ê¸°
    networks:
      - frontend
      - backend
    
  api:
    build: ./api
    environment:
      # ğŸ”¥ ì„œë¹„ìŠ¤ëª…ìœ¼ë¡œ ë‚´ë¶€ DNS í•´ê²°
      - DATABASE_URL=postgresql://user:pass@db:5432/myapp
      - REDIS_URL=redis://redis:6379
    healthcheck:  # ğŸ”¥ í—¬ìŠ¤ì²´í¬ ì •ì˜
      test: ["CMD", "curl", "-f", "http://localhost:5000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
    networks:
      - backend
  
  db:
    image: postgres:13
    networks:
      - backend  # ğŸ”¥ ë„¤íŠ¸ì›Œí¬ ë¶„ë¦¬ë¡œ ë³´ì•ˆ ê°•í™”
    
networks:
  frontend:  # ì›¹-API í†µì‹ ìš©
  backend:   # API-DB í†µì‹ ìš©