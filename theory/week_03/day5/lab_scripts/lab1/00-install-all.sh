#!/bin/bash

# Week 3 Day 5 Lab 1: μ „μ²΄ μ„¤μΉ μ¤ν¬λ¦½νΈ
# μ‚¬μ©λ²•: ./00-install-all.sh

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—"
echo "β•‘  Week 3 Day 5 Lab 1: μ΄μ ν™κ²½ κµ¬μ¶• - μ „μ²΄ μ„¤μΉ          β•‘"
echo "β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•"
echo ""
echo "β±οΈ  μμƒ μ†μ” μ‹κ°„: μ•½ 10-15λ¶„"
echo ""

read -p "κ³„μ† μ§„ν–‰ν•μ‹κ² μµλ‹κΉ? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "μ„¤μΉκ°€ μ·¨μ†λμ—μµλ‹λ‹¤."
    exit 1
fi

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "Step 0/6: ν΄λ¬μ¤ν„° ν™κ²½ μ„¤μ •"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
bash "$SCRIPT_DIR/00-setup-cluster.sh"

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "Step 1/6: Helm μ„¤μΉ"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
bash "$SCRIPT_DIR/01-install-helm.sh"

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "Step 2/6: Prometheus Stack μ„¤μΉ"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
bash "$SCRIPT_DIR/02-install-prometheus.sh"

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "Step 3/6: ν…μ¤νΈ μ• ν”λ¦¬μΌ€μ΄μ… λ°°ν¬"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
bash "$SCRIPT_DIR/03-deploy-app.sh"

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "Step 4/6: Metrics Server λ° HPA μ„¤μ •"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
bash "$SCRIPT_DIR/04-setup-hpa.sh"

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "Step 5/6: ArgoCD μ„¤μΉ"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
bash "$SCRIPT_DIR/05-install-argocd.sh"

echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "Step 6/6: ν¬νΈν¬μ›λ”© μ‹μ‘"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
bash "$SCRIPT_DIR/06-start-portforward.sh"

echo ""
echo "β•”β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•—"
echo "β•‘  π‰ μ „μ²΄ μ„¤μΉ μ™„λ£!                                       β•‘"
echo "β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•"
echo ""
echo "π“ μ„¤μΉλ μ»΄ν¬λ„νΈ:"
echo "   β… Kubernetes ν΄λ¬μ¤ν„° (day5-lab namespace)"
echo "   β… Helm"
echo "   β… Prometheus + Grafana"
echo "   β… ν…μ¤νΈ μ• ν”λ¦¬μΌ€μ΄μ…"
echo "   β… Metrics Server + HPA"
echo "   β… ArgoCD"
echo ""
echo "π μ ‘μ† μ •λ³΄:"
echo ""
echo "   π“ Grafana:"
echo "      http://localhost:3000 (admin/admin123)"
echo ""
echo "   π“ Prometheus:"
echo "      http://localhost:9090"
echo ""
echo "   π€ ArgoCD:"
echo "      https://localhost:8080"
echo ""
echo "   π Web App:"
echo "      http://localhost:8081"
echo ""
echo "π’΅ ν¬νΈν¬μ›λ”© κ΄€λ¦¬:"
echo "   μ¤‘μ§€: ./07-stop-portforward.sh"
echo "   μ¬μ‹μ‘: ./06-start-portforward.sh"
echo ""
echo "π’΅ λ‹¤μ λ‹¨κ³„:"
echo "   1. Grafana λ€μ‹λ³΄λ“ ν™•μΈ"
echo "   2. HPA λ¶€ν• ν…μ¤νΈ"
echo "   3. ArgoCD Application μƒμ„±"
echo ""
echo "π“ μμ„Έν• λ‚΄μ©μ€ lab_1.mdλ¥Ό μ°Έκ³ ν•μ„Έμ”."
