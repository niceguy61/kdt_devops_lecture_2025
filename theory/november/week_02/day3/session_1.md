# November Week 2 Day 3 Session 1: ECR & ECS ê¸°ì´ˆ

<div align="center">

**ğŸ³ ì»¨í…Œì´ë„ˆ** â€¢ **ğŸ“¦ ECR** â€¢ **âš™ï¸ ECS** â€¢ **ğŸ¯ Task Definition**

*AWS ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„œë¹„ìŠ¤ ì™„ë²½ ì´í•´*

</div>

---

## ğŸ•˜ Session ì •ë³´
**ì‹œê°„**: 09:00-09:40 (40ë¶„)
**ëª©í‘œ**: ECRê³¼ ECS ê¸°ë³¸ ê°œë… ì´í•´ ë° ì•„í‚¤í…ì²˜ íŒŒì•…
**ë°©ì‹**: ì´ë¡  + AWS ê³µì‹ ë¬¸ì„œ ê¸°ë°˜ ì„¤ëª…

## ğŸ¯ í•™ìŠµ ëª©í‘œ

### ğŸ“š ì´í•´ ëª©í‘œ
- ECRì˜ ì—­í• ê³¼ Docker Hubì™€ì˜ ì°¨ì´ ì´í•´
- ECS ì•„í‚¤í…ì²˜ (Cluster, Service, Task) íŒŒì•…
- Task Definition êµ¬ì¡° ì´í•´
- EC2 vs Fargate ë¹„êµ

### ğŸ› ï¸ ì ìš© ëª©í‘œ
- ECRì— ì´ë¯¸ì§€ í‘¸ì‹œ ë°©ë²• ìŠµë“
- Task Definition ì‘ì„± ëŠ¥ë ¥
- ì ì ˆí•œ Launch Type ì„ íƒ

---

## ğŸ¤” ì™œ í•„ìš”í•œê°€? (5ë¶„)

### ğŸ’¼ ì‹¤ë¬´ ì‹œë‚˜ë¦¬ì˜¤: Docker Compose â†’ AWS ë§ˆì´ê·¸ë ˆì´ì…˜

**ë¬¸ì œ ìƒí™©**:
```
ë¡œì»¬ Docker Compose:
- docker-compose up (ë‹¨ì¼ ì„œë²„)
- í™•ì¥ì„± ì œí•œ
- ê³ ê°€ìš©ì„± ë¶€ì¡±
- ìˆ˜ë™ ë°°í¬

í”„ë¡œë•ì…˜ ìš”êµ¬ì‚¬í•­:
- ìë™ í™•ì¥ (íŠ¸ë˜í”½ ì¦ê°€ ì‹œ)
- ê³ ê°€ìš©ì„± (ì„œë²„ ì¥ì•  ëŒ€ì‘)
- ë¬´ì¤‘ë‹¨ ë°°í¬
- ëª¨ë‹ˆí„°ë§ & ë¡œê¹…
```

**ECS ì†”ë£¨ì…˜**:
```
Docker ì´ë¯¸ì§€ â†’ ECR (ì €ì¥)
              â†“
         ECS (ì‹¤í–‰ & ê´€ë¦¬)
              â†“
    - ìë™ í™•ì¥ âœ…
    - ê³ ê°€ìš©ì„± âœ…
    - ë¬´ì¤‘ë‹¨ ë°°í¬ âœ…
    - CloudWatch í†µí•© âœ…
```

### ğŸ  ì‹¤ìƒí™œ ë¹„ìœ 

**ë¬¼ë¥˜ ì„¼í„°**:
- **ECR**: ì°½ê³  (Docker ì´ë¯¸ì§€ ë³´ê´€)
- **ECS Cluster**: ë¬¼ë¥˜ ì„¼í„° ì „ì²´
- **Task Definition**: ì‘ì—… ì§€ì‹œì„œ (ì–´ë–¤ ì»¨í…Œì´ë„ˆë¥¼ ì–´ë–»ê²Œ ì‹¤í–‰í• ì§€)
- **Task**: ì‹¤ì œ ì‘ì—… (ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì¤‘)
- **Service**: ì‘ì—… ê´€ë¦¬ì (Taskë¥¼ ê³„ì† ìœ ì§€)

---

## ğŸ“– í•µì‹¬ ê°œë… (30ë¶„)

### ğŸ” ê°œë… 1: ECR (Elastic Container Registry) (8ë¶„)

> **ì •ì˜** (AWS ê³µì‹): Amazon ECRì€ ì™„ì „ ê´€ë¦¬í˜• Docker ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ë¡œ, ê°œë°œìê°€ Docker ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ë¥¼ ì‰½ê²Œ ì €ì¥, ê´€ë¦¬ ë° ë°°í¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

#### ECR vs Docker Hub

| íŠ¹ì§• | ECR | Docker Hub |
|------|-----|------------|
| **ìœ„ì¹˜** | AWS ë‚´ë¶€ | ì™¸ë¶€ (ì¸í„°ë„·) |
| **ì†ë„** | ë¹ ë¦„ (ê°™ì€ ë¦¬ì „) | ëŠë¦¼ (ì¸í„°ë„· ê²½ìœ ) |
| **ë³´ì•ˆ** | IAM í†µí•© | ë³„ë„ ì¸ì¦ |
| **ë¹„ìš©** | ìŠ¤í† ë¦¬ì§€ + ì „ì†¡ | ë¬´ë£Œ (ì œí•œ) / ìœ ë£Œ |
| **Private** | ê¸°ë³¸ Private | ìœ ë£Œ |
| **ECS í†µí•©** | ë„¤ì´í‹°ë¸Œ | ê°€ëŠ¥ (ëŠë¦¼) |

#### ECR ì£¼ìš” ê¸°ëŠ¥

**1. Private Repository**:
```
AWS ê³„ì • ë‚´ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥
IAM ì •ì±…ìœ¼ë¡œ ì„¸ë°€í•œ ê¶Œí•œ ì œì–´
```

**2. ì´ë¯¸ì§€ ìŠ¤ìº”**:
```
ì·¨ì•½ì  ìë™ ìŠ¤ìº”
CVE ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë°˜
í‘¸ì‹œ ì‹œ ìë™ ìŠ¤ìº” ê°€ëŠ¥
```

**3. ìˆ˜ëª… ì£¼ê¸° ì •ì±…**:
```
ì˜¤ë˜ëœ ì´ë¯¸ì§€ ìë™ ì‚­ì œ
ë¹„ìš© ì ˆê°
ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬ ìë™í™”
```

#### ECR ì‚¬ìš© íë¦„

```mermaid
graph LR
    A[ë¡œì»¬ Docker ì´ë¯¸ì§€] --> B[docker tag]
    B --> C[ECR ë¡œê·¸ì¸]
    C --> D[docker push]
    D --> E[ECR Repository]
    E --> F[ECS Task]
    
    style A fill:#e3f2fd
    style E fill:#fff3e0
    style F fill:#e8f5e8
```

**ì‹¤ì œ ëª…ë ¹ì–´**:
```bash
# 1. ECR ë¡œê·¸ì¸
aws ecr get-login-password --region ap-northeast-2 | \
  docker login --username AWS --password-stdin \
  123456789012.dkr.ecr.ap-northeast-2.amazonaws.com

# 2. ì´ë¯¸ì§€ íƒœê·¸
docker tag my-app:latest \
  123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/my-app:latest

# 3. ì´ë¯¸ì§€ í‘¸ì‹œ
docker push \
  123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/my-app:latest
```

### ğŸ” ê°œë… 2: ECS ì•„í‚¤í…ì²˜ (12ë¶„)

> **ì •ì˜** (AWS ê³µì‹): Amazon ECSëŠ” ì™„ì „ ê´€ë¦¬í˜• ì»¨í…Œì´ë„ˆ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ì„œë¹„ìŠ¤ë¡œ, Docker ì»¨í…Œì´ë„ˆë¥¼ ì‰½ê²Œ ì‹¤í–‰, ì¤‘ì§€ ë° ê´€ë¦¬í•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

#### ECS í•µì‹¬ êµ¬ì„± ìš”ì†Œ

```mermaid
graph TB
    subgraph "ECS Cluster"
        subgraph "Service"
            T1[Task 1<br/>ì»¨í…Œì´ë„ˆ ì‹¤í–‰]
            T2[Task 2<br/>ì»¨í…Œì´ë„ˆ ì‹¤í–‰]
            T3[Task 3<br/>ì»¨í…Œì´ë„ˆ ì‹¤í–‰]
        end
        TD[Task Definition<br/>ì‘ì—… ì§€ì‹œì„œ]
    end
    
    ALB[Application Load Balancer] --> T1
    ALB --> T2
    ALB --> T3
    
    TD -.ì •ì˜.-> T1
    TD -.ì •ì˜.-> T2
    TD -.ì •ì˜.-> T3
    
    style TD fill:#ff9800
    style T1 fill:#4caf50
    style T2 fill:#4caf50
    style T3 fill:#4caf50
    style ALB fill:#2196f3
```

**1. Cluster (í´ëŸ¬ìŠ¤í„°)**:
- **ì—­í• **: ì»¨í…Œì´ë„ˆ ì¸ìŠ¤í„´ìŠ¤ì˜ ë…¼ë¦¬ì  ê·¸ë£¹
- **ë¹„ìœ **: ë¬¼ë¥˜ ì„¼í„° ì „ì²´
- **ì˜ˆì‹œ**: `production-cluster`, `dev-cluster`

**2. Task Definition (ì‘ì—… ì •ì˜)**:
- **ì—­í• **: ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë°©ë²•ì„ ì •ì˜í•˜ëŠ” JSON í…œí”Œë¦¿
- **ë¹„ìœ **: ì‘ì—… ì§€ì‹œì„œ (ì–´ë–¤ ì´ë¯¸ì§€, ì–¼ë§ˆë‚˜ CPU/ë©”ëª¨ë¦¬)
- **ë‚´ìš©**:
  ```json
  {
    "family": "my-app",
    "containerDefinitions": [{
      "name": "web",
      "image": "123456789012.dkr.ecr.ap-northeast-2.amazonaws.com/my-app:latest",
      "cpu": 256,
      "memory": 512,
      "portMappings": [{
        "containerPort": 3000,
        "protocol": "tcp"
      }]
    }]
  }
  ```

**3. Task (ì‘ì—…)**:
- **ì—­í• **: Task Definitionì˜ ì¸ìŠ¤í„´ìŠ¤ (ì‹¤ì œ ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ)
- **ë¹„ìœ **: ì‹¤ì œ ì‘ì—… ì¤‘ì¸ ì§ì›
- **ìƒëª…ì£¼ê¸°**: ì‹œì‘ â†’ ì‹¤í–‰ â†’ ì¢…ë£Œ

**4. Service (ì„œë¹„ìŠ¤)**:
- **ì—­í• **: ì›í•˜ëŠ” ìˆ˜ì˜ Taskë¥¼ ìœ ì§€í•˜ê³  ê´€ë¦¬
- **ë¹„ìœ **: ì‘ì—… ê´€ë¦¬ì (í•­ìƒ 3ëª…ì´ ì¼í•˜ë„ë¡ ê´€ë¦¬)
- **ê¸°ëŠ¥**:
  - Task ê°œìˆ˜ ìœ ì§€ (Desired Count)
  - ìë™ ë³µêµ¬ (Task ì‹¤íŒ¨ ì‹œ ì¬ì‹œì‘)
  - ë¡œë“œ ë°¸ëŸ°ì„œ í†µí•©
  - Auto Scaling

#### ECS ë™ì‘ íë¦„

```mermaid
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant S as ECS Service
    participant TD as Task Definition
    participant T as Task (ì»¨í…Œì´ë„ˆ)
    
    U->>S: Desired Count = 3
    S->>TD: Task Definition ì°¸ì¡°
    TD->>T: Task 1 ìƒì„±
    TD->>T: Task 2 ìƒì„±
    TD->>T: Task 3 ìƒì„±
    
    Note over T: Task 2 ì‹¤íŒ¨!
    T->>S: Task 2 ì¢…ë£Œ ì•Œë¦¼
    S->>TD: ìƒˆ Task ìƒì„±
    TD->>T: Task 4 ìƒì„±
    
    Note over S,T: í•­ìƒ 3ê°œ ìœ ì§€
```

### ğŸ” ê°œë… 3: EC2 vs Fargate (10ë¶„)

> **AWS ê³µì‹**: ECSëŠ” ë‘ ê°€ì§€ Launch Typeì„ ì§€ì›í•©ë‹ˆë‹¤ - EC2 (ì§ì ‘ ê´€ë¦¬)ì™€ Fargate (ì„œë²„ë¦¬ìŠ¤).

#### Launch Type ë¹„êµ

| íŠ¹ì§• | EC2 | Fargate |
|------|-----|---------|
| **ì„œë²„ ê´€ë¦¬** | í•„ìš” (EC2 ì¸ìŠ¤í„´ìŠ¤) | ë¶ˆí•„ìš” (ì„œë²„ë¦¬ìŠ¤) |
| **ë¹„ìš©** | ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš© | Task ì‹¤í–‰ ì‹œê°„ |
| **í™•ì¥ì„±** | ìˆ˜ë™ (ASG) | ìë™ |
| **ì‹œì‘ ì‹œê°„** | ë¹ ë¦„ (ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„ë¨) | ëŠë¦¼ (ì½œë“œ ìŠ¤íƒ€íŠ¸) |
| **ì»¤ìŠ¤í„°ë§ˆì´ì§•** | ë†’ìŒ (OS ì ‘ê·¼) | ë‚®ìŒ (ì œí•œì ) |
| **ì í•©í•œ ê²½ìš°** | ëŒ€ê·œëª¨, ì˜ˆì¸¡ ê°€ëŠ¥ | ì†Œê·œëª¨, ê°€ë³€ì  |

#### EC2 Launch Type

**ì•„í‚¤í…ì²˜**:
```
ECS Cluster
â”œâ”€â”€ EC2 Instance 1 (t3.medium)
â”‚   â”œâ”€â”€ Task 1 (ì»¨í…Œì´ë„ˆ)
â”‚   â””â”€â”€ Task 2 (ì»¨í…Œì´ë„ˆ)
â”œâ”€â”€ EC2 Instance 2 (t3.medium)
â”‚   â”œâ”€â”€ Task 3 (ì»¨í…Œì´ë„ˆ)
â”‚   â””â”€â”€ Task 4 (ì»¨í…Œì´ë„ˆ)
```

**ì¥ì **:
- âœ… ë¹„ìš© íš¨ìœ¨ì  (Reserved Instance)
- âœ… ì™„ì „í•œ ì œì–´ (OS, ë„¤íŠ¸ì›Œí¬)
- âœ… GPU, íŠ¹ìˆ˜ í•˜ë“œì›¨ì–´ ì‚¬ìš© ê°€ëŠ¥

**ë‹¨ì **:
- âŒ ì„œë²„ ê´€ë¦¬ í•„ìš” (íŒ¨ì¹˜, ëª¨ë‹ˆí„°ë§)
- âŒ ìš©ëŸ‰ ê³„íš í•„ìš”
- âŒ í™•ì¥ ë³µì¡

#### Fargate Launch Type

**ì•„í‚¤í…ì²˜**:
```
ECS Cluster (ì„œë²„ë¦¬ìŠ¤)
â”œâ”€â”€ Task 1 (ë…ë¦½ ì‹¤í–‰)
â”œâ”€â”€ Task 2 (ë…ë¦½ ì‹¤í–‰)
â”œâ”€â”€ Task 3 (ë…ë¦½ ì‹¤í–‰)
â””â”€â”€ Task 4 (ë…ë¦½ ì‹¤í–‰)
```

**ì¥ì **:
- âœ… ì„œë²„ ê´€ë¦¬ ë¶ˆí•„ìš”
- âœ… ìë™ í™•ì¥
- âœ… ë¹ ë¥¸ ì‹œì‘ (ì¸í”„ë¼ ì¤€ë¹„ ë¶ˆí•„ìš”)
- âœ… ë³´ì•ˆ ê²©ë¦¬ (Taskë³„ ë…ë¦½)

**ë‹¨ì **:
- âŒ ë¹„ìš© ë†’ìŒ (ì†Œê·œëª¨ëŠ” ê´œì°®ìŒ)
- âŒ ì œí•œì  ì»¤ìŠ¤í„°ë§ˆì´ì§•
- âŒ ì½œë“œ ìŠ¤íƒ€íŠ¸ ì§€ì—°

#### ì„ íƒ ê¸°ì¤€

```mermaid
graph TB
    A{ì›Œí¬ë¡œë“œ íŠ¹ì„±}
    A -->|ì˜ˆì¸¡ ê°€ëŠ¥<br/>ëŒ€ê·œëª¨| B[EC2]
    A -->|ê°€ë³€ì <br/>ì†Œê·œëª¨| C[Fargate]
    
    B --> D[Reserved Instance<br/>ë¹„ìš© ì ˆê°]
    C --> E[ìš´ì˜ ë¶€ë‹´ ìµœì†Œí™”]
    
    style A fill:#fff3e0
    style B fill:#e3f2fd
    style C fill:#e8f5e8
    style D fill:#e3f2fd
    style E fill:#e8f5e8
```

**ì‹¤ë¬´ ê¶Œì¥**:
- **Fargate ìš°ì„ **: ëŒ€ë¶€ë¶„ì˜ ê²½ìš° (ìš´ì˜ ê°„í¸)
- **EC2 ê³ ë ¤**: ëŒ€ê·œëª¨ + ì˜ˆì¸¡ ê°€ëŠ¥ + ë¹„ìš© ë¯¼ê°

---

## ğŸ’° ë¹„ìš© êµ¬ì¡° (5ë¶„)

### ECR ë¹„ìš© (ap-northeast-2)

**ìŠ¤í† ë¦¬ì§€**:
```
$0.10/GB/ì›”
ì˜ˆ: 10GB ì´ë¯¸ì§€ = $1.00/ì›”
```

**ë°ì´í„° ì „ì†¡**:
```
ê°™ì€ ë¦¬ì „ ECS â†’ ë¬´ë£Œ
ì¸í„°ë„· â†’ $0.126/GB (ì²« 10TB)
```

### ECS ë¹„ìš©

**EC2 Launch Type**:
```
EC2 ì¸ìŠ¤í„´ìŠ¤ ë¹„ìš©ë§Œ ë°œìƒ
ECS ìì²´ëŠ” ë¬´ë£Œ

ì˜ˆ: t3.medium 2ëŒ€
$0.0416/ì‹œê°„ Ã— 2 Ã— 730ì‹œê°„ = $60.74/ì›”
```

**Fargate Launch Type**:
```
vCPU: $0.04656/vCPU/ì‹œê°„
ë©”ëª¨ë¦¬: $0.00511/GB/ì‹œê°„

ì˜ˆ: 0.25 vCPU + 0.5GB ë©”ëª¨ë¦¬
($0.04656 Ã— 0.25 + $0.00511 Ã— 0.5) Ã— 730ì‹œê°„
= $12.20/ì›” (1ê°œ Task 24/7 ì‹¤í–‰)
```

### ë¹„ìš© ë¹„êµ (ì›”ê°„)

| ì‹œë‚˜ë¦¬ì˜¤ | EC2 | Fargate |
|---------|-----|---------|
| **ì†Œê·œëª¨** (2 Task) | $60.74 | $24.40 |
| **ì¤‘ê·œëª¨** (10 Task) | $60.74 | $122.00 |
| **ëŒ€ê·œëª¨** (50 Task) | $243.00 | $610.00 |

**ê²°ë¡ **: ì†Œê·œëª¨ëŠ” Fargate, ëŒ€ê·œëª¨ëŠ” EC2ê°€ ìœ ë¦¬

---

## ğŸ”‘ í•µì‹¬ í‚¤ì›Œë“œ

- **ECR**: Docker ì´ë¯¸ì§€ ì €ì¥ì†Œ (Private, IAM í†µí•©)
- **ECS Cluster**: ì»¨í…Œì´ë„ˆ ì¸ìŠ¤í„´ìŠ¤ ê·¸ë£¹
- **Task Definition**: ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë°©ë²• ì •ì˜ (JSON)
- **Task**: ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ì¸ìŠ¤í„´ìŠ¤
- **Service**: Task ê°œìˆ˜ ìœ ì§€ ë° ê´€ë¦¬
- **EC2 Launch Type**: ì§ì ‘ ê´€ë¦¬ (ë¹„ìš© íš¨ìœ¨)
- **Fargate Launch Type**: ì„œë²„ë¦¬ìŠ¤ (ìš´ì˜ ê°„í¸)

---

## ğŸ“ Session ë§ˆë¬´ë¦¬

### âœ… ì˜¤ëŠ˜ Session ì„±ê³¼
- [ ] ECRì˜ ì—­í• ê³¼ Docker Hub ì°¨ì´ ì´í•´
- [ ] ECS ì•„í‚¤í…ì²˜ (Cluster, Service, Task, Task Definition) íŒŒì•…
- [ ] EC2 vs Fargate ë¹„êµ ë° ì„ íƒ ê¸°ì¤€ ìŠµë“
- [ ] ë¹„ìš© êµ¬ì¡° ì´í•´

### ğŸ¯ ë‹¤ìŒ Session ì¤€ë¹„
- **Session 2**: Fargate ì„œë²„ë¦¬ìŠ¤ ì»¨í…Œì´ë„ˆ (ë„¤íŠ¸ì›Œí‚¹, ë¡œê¹…)
- **ì—°ê³„**: Task Definition ì‘ì„± ë° Fargate ë°°í¬

### ğŸ”— ê³µì‹ ë¬¸ì„œ (í•„ìˆ˜)

**âš ï¸ í•™ìƒë“¤ì´ ì§ì ‘ í™•ì¸í•´ì•¼ í•  ê³µì‹ ë¬¸ì„œ**:
- ğŸ“˜ [Amazon ECSë€?](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/Welcome.html)
- ğŸ“— [Task Definition íŒŒë¼ë¯¸í„°](https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definitions.html)
- ğŸ“™ [ECR ì‚¬ìš©ì ê°€ì´ë“œ](https://docs.aws.amazon.com/AmazonECR/latest/userguide/)
- ğŸ“• [ECS ìš”ê¸ˆ](https://aws.amazon.com/ecs/pricing/)
- ğŸ†• [ECS ìµœì‹  ì—…ë°ì´íŠ¸](https://aws.amazon.com/ecs/whats-new/)

---

<div align="center">

**ğŸ³ ì»¨í…Œì´ë„ˆ** â€¢ **ğŸ“¦ ECR** â€¢ **âš™ï¸ ECS** â€¢ **ğŸ¯ Task Definition**

*ë‹¤ìŒ: Session 2 - Fargate ì„œë²„ë¦¬ìŠ¤ ì»¨í…Œì´ë„ˆ*

</div>
