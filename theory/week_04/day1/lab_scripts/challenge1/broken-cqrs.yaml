# ë¬¸ì œ 2: CQRS íŒ¨í„´ ì½ê¸°/ì“°ê¸° ë¶„ë¦¬ ì˜¤ë¥˜
# Commandì™€ Query ì„œë¹„ìŠ¤ì˜ ì˜ë„ì  ì˜¤ë¥˜ë“¤

apiVersion: apps/v1
kind: Deployment
metadata:
  name: command-service
  namespace: microservices-challenge
spec:
  replicas: 2
  selector:
    matchLabels:
      app: command-service
  template:
    metadata:
      labels:
        app: command-service
    spec:
      containers:
      - name: command-service
        image: nginx:1.25
        ports:
        - containerPort: 80
        volumeMounts:
        - name: command-config
          mountPath: /etc/nginx/conf.d
      volumes:
      - name: command-config
        configMap:
          name: command-service-config
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: command-service-config
  namespace: microservices-challenge
data:
  default.conf: |
    server {
        listen 80;
        # ğŸ”§ FIX ME 1: JSON í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤
        location /api/commands/create-user {
            return 200 '{
                command_id: "cmd-001",
                type: "CreateUserCommand",
                status: "accepted",
                event_id: "evt-001",
                timestamp: "2024-01-01T10:00:00Z"
            }';
            add_header Content-Type application/json;
        }
        # ğŸ”§ FIX ME 2: ì´ ê²½ë¡œë¡œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤
        location /api/commands/update-user-wrong {
            return 200 '{
                "command_id": "cmd-002", 
                "type": "UpdateUserCommand",
                "status": "accepted",
                "event_id": "evt-002",
                "timestamp": "2024-01-01T10:01:00Z"
            }';
            add_header Content-Type application/json;
        }
    }
---
apiVersion: v1
kind: Service
metadata:
  name: command-service
  namespace: microservices-challenge
spec:
  selector:
    app: command-service
  ports:
  # ğŸ”§ FIX ME 3: Serviceê°€ Podì— ì—°ê²°ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤
  - port: 80
    targetPort: 8080
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: query-service
  namespace: microservices-challenge
spec:
  replicas: 3
  selector:
    matchLabels:
      app: query-service
  template:
    metadata:
      labels:
        app: query-service
    spec:
      containers:
      - name: query-service
        image: nginx:1.25
        ports:
        - containerPort: 80
        volumeMounts:
        - name: query-config
          mountPath: /etc/nginx/conf.d
      volumes:
      - name: query-config
        configMap:
          name: query-service-config
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: query-service-config
  namespace: microservices-challenge
data:
  default.conf: |
    server {
        listen 80;
        location /api/queries/users {
            # ğŸ”§ FIX ME 4: JSON ì‘ë‹µì´ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤
            return 200 '{
                "users": [
                    {"id": 1, "name": "John Doe", "email": "john@example.com", "status": "active"},
                    {"id": 2, "name": "Jane Smith", "email": "jane@example.com", "status": "active"
                ],
                "total": 2,
                "source": "materialized_view",
                "last_updated": "2024-01-01T10:01:00Z"
            }';
            add_header Content-Type application/json;
        }
        location /api/queries/user-stats {
            return 200 '{
                "total_users": 1000,
                "active_users": 850,
                "new_users_today": 25,
                "source": "aggregated_view",
                "last_updated": "2024-01-01T10:00:00Z"
            }';
            add_header Content-Type application/json;
        }
    }
---
apiVersion: v1
kind: Service
metadata:
  name: query-service
  namespace: microservices-challenge
spec:
  selector:
    # ğŸ”§ FIX ME 5: Serviceì— ì—”ë“œí¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤
    app: wrong-query-service
  ports:
  - port: 80
    targetPort: 80
